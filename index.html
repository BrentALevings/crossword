<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        .container {
            position: absolute;
            bottom: 0;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
        }

        .crosswordDisplay {
            top: 3rem;
        }

        .clueBlock {
            position: relative;
            margin-bottom: 5em;
            text-align: left;
        }

        .clueDirection {
            text-align: left;
            margin: 1em 0 0.25em 122px;
            font-size: 1.5em;
            font-weight: bold;
            color: #000;
        }

        .line {}

        .word,
        .clue,
        .lineNum {
            display: inline-block;
            height: 1.4em;
            padding: 0 2px;
        }

        .word {
            text-align: right;
            width: 100px;
            margin: 0 20px 0 0;
        }

        .clue {
            width: 900px;
            margin: 0 0 4px 0;
        }

        .lineNum {
            text-align: left;
            font: 1em calibri;
            line-height: 1.8em;

        }

        .clueReadOnly {
            border-color: rgba(0, 0, 0, 0);
            margin: 0;
            outline: 0;
            color: #303030;
            background: none;
        }

        .crossword {
            display: block;
            background-color: rgb(255, 255, 255);
        }

        .square {
            margin: 0 1px 1px 0;
            display: inline-block;
            position: relative;
            font: 24px Calibri;
            width: 1.25em;
            height: 1.25em;
            line-height: 1.25em;
            vertical-align: top;
        }

        .char:focus {
            -webkit-box-shadow: 0 0 0 2px rgb(0, 133, 180);
            -moz-box-shadow: 0 0 0 2px rgb(0, 133, 180);
            box-shadow: inset 0 0 0 2px rgb(0, 133, 180);
        }

        .char {
            font-family: sans-serif;
            font-size: 24px;
            text-transform: uppercase;
            outline: 0;
            border: 0;
            padding: 0;
            margin: 1px 0 0-1px;
            width: 1.25em;
            height: 1.25em;
            text-align: center;
            background-color: rgb(200, 200, 200);
        }

        .charReadOnly:focus {
            -webkit-box-shadow: 0 !important;
            -moz-box-shadow: 0 !important;
            box-shadow: 0 !important;

            border-color: rgba(0, 0, 0, 0);
            margin: 0;
            outline: 0;
            color: #303030;
        }

        .num {
            position: absolute;
            top: 0;
            left: 0;
            text-align: left;
            color: rgb(0, 0, 0);
            font-size: 0.5em;
            line-height: 1em;
            pointer-events: none;
        }

        .hide {
            visibility: hidden;
        }

        .disabled {
            display: none !important;
        }

        .btn:hover {
            cursor: pointer;
            background-color: rgb(150, 150, 150);
        }

        #btnCheck {
            position: absolute;
            right: 2rem;
            top: 2rem;
            cursor: pointer;
            color: black;
        }

        #btnReset {
            position: absolute;
            left: 2rem;
            top: 2rem;
            cursor: pointer;
            color: black;
        }

        #btnShow {
            position: absolute;
            left: 12rem;
            top: 2rem;
            cursor: pointer;
            color: black;
        }

        input {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            width: 250px;
        }

        /* Clue container row */
        .line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        /* Number box */
        .lineNum {
            min-width: 25px;
            font-weight: bold;
            margin-right: 8px;
            text-align: right;
        }

        /* Clue text */
        .clue {
            flex: 1;
            text-align: left;
            white-space: normal;
            /* allows wrapping */
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            #crossword {
                display: inline-block;
                margin: 10px auto;
                border-collapse: collapse;
            }

            .clueBlock {
                position: relative;
                margin-bottom: 5em;
                text-align: left;
            }

            .row {
                display: flex;
            }

            .square {
                width: 30px;
                height: 30px;
                border: none;
                /* ensures the box shows in print */
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
            }

            .char {
                width: 100%;
                height: 100%;
                text-align: center;
                border: 1px solid black;
                /* removes the browserâ€™s input border */
                font-size: 16px;
                font-weight: bold;
                text-transform: uppercase;
            }

            .num {
                position: absolute;
                top: 2px;
                left: 2px;
                font-size: 10px;
            }

            /* Clue container row */
            .line {
                display: flex;
                align-items: flex-start;
                margin-bottom: 6px;
            }

            /* Number box */
            .lineNum {
                min-width: 25px;
                font-weight: bold;
                margin-right: 8px;
                text-align: right;
            }

            /* Clue text */
            .clue {
                flex: 1;
                text-align: left;
                white-space: normal;
                /* allows wrapping */
            }

            /* Hide the buttons when printing */
            #printBtn,
            #btnReset,
            #btnCheck,
            #btnShow,
            .top-right-buttons {
                display: none !important;
            }
        }

        #printBtn {
            position: fixed;
            /* stays in place even when scrolling */
            top: 10px;
            /* distance from top */
            right: 10px;
            /* distance from right */
            padding: 8px 14px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.2);
        }

        #printBtn:hover {
            background: #45a049;
        }

    </style>
</head>
<div class="container crosswordDisplay">
    <button id="printBtn">Print / Save as PDF</button>

    <div class="row">
        <!-- Create & Play buttons required for user generated crossword-disabled for Proscribed questions -->
        <div class="btn btn-default disabled" id="btnCreate">Create</div>
        <div class="btn btn-default disabled" id="btnPlay">Play</div>

        <div class="btn btn-default" id="btnReset">Reset</div>
        <div class="btn btn-default" id="btnCheck">Check Answers</div>
        <div class="btn btn-default" id="btnShow">Show Answers</div>
    </div>
    <div class="form">
        <label for="name">Full Name:</label>
        <input type="text" id="name" class="name" />

        <label for="contact">Contact:</label>
        <input type="text" id="contact" class="contact" />
    </div>
    <div class="center crossword" id="crossword"></div>
    <div class="btn" id="btnGen">Generate</div>
    <div class="col-lg-6 ">
        <div class="clueBlock" id="cluesAcross">
            <div class="clueDirection" id="directionAcross">ACROSS</div>

            <div class="line">
                <input class="word" type="text" value="LYMPHEDEMA" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Chronic swelling often managed with compression therapy and exercise. (10)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="ROM" />
                <span class="lineNum"></span>
                <input class="clue" value="Clinical measure of how far a joint can move. (3)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="OCCUPATION" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="The central concept in OT; what gives meaning and purpose to daily life. (10)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="RESTINGSPLINT" />
                <span class="lineNum"></span>
                <input class="clue" value="Orthosis prescribed to immobilize and protect joints. (13)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="ASSISTIVEDEVICES" />
                <span class="lineNum"></span>
                <input class="clue" value="Tools that promote independence. (eg: built-up grip) (16)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="LEISURE" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Chosen activities that provide enjoyment and restoration, often disrupted after illness or injury. (7)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="REACHER" />
                <span class="lineNum"></span>
                <input class="clue" value="A tool used to grasp objects without bending or overexertion. (7)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="HOLISTIC" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="The approach OTs take, addressing body, mind, and environment together. (8)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="THERABAND" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Elastic resistance tool used in graded strengthening and rehabilitation exercises. (9)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="TRANSFERBOARD" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Device that enables safe movement between surfaces, such as bed to wheelchair. (13)" />
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="clueBlock" id="cluesDown">
            <div class="clueDirection" id="directionDown">DOWN</div>
            <div class="line">
                <input class="word" type="text" value="ADL" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Everyday tasks like dressing or bathing that OTs often assess and retrain. (3)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="COGNITION" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Mental processes such as memory and attention that impact occupational performance. (9)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="WHEELCHAIR" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Mobility solution that may require postural support and custom seating. (10)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="DYNAMOMETER" />
                <span class="lineNum"></span>
                <input class="clue" value="Instrument used by OTs to objectively measure grip strength. (11)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="TBI" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Injury that can cause lasting physical, cognitive, and behavioral changes. (3)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="ETI" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Common hand trauma affecting finger extension, often requiring splinting and therapy. (3)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="OTASA" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="National association representing Occupational Therapists in South Africa. (5)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="VOC" />
                <span class="lineNum"></span>
                <input class="clue" value="Abbreviation for rehab focus on employment readiness and skills. (5)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="PEDIATRICS" />
                <span class="lineNum"></span>
                <input class="clue" value="OT practice area supporting developmental milestones in children. (10)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="SAISI" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="South African society in which therapists focus on sensory integration. (5)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="PNF" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Rehabilitation method using patterned movements to restore function after a stroke. (3)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="BOBATH" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Neurodevelopmental therapy approach focusing on posture and movement control. (6)" />
            </div>

            <div class="line">
                <input class="word" type="text" value="GONIOMETER" />
                <span class="lineNum"></span>
                <input class="clue"
                    value="Instrument OTs use to measure joint angles and assess range of motion. (10)" />
            </div>
        </div>

    </div>
</div>
<script>
    document.getElementById("printBtn").addEventListener("click", () => {
        window.print();
    });
    //---------------------------------//
    //   GLOBAL VARIABLES              //
    //---------------------------------//

    var board, wordArr, wordBank, wordsActive, boardMap,
        focusChar, focusIndex = null, mode,
        wordElementsAcross, wordElementsDown;

    var answers = [];

    var Bounds = {
        top: 0, right: 0, bottom: 0, left: 0,

        Update: function (x, y) {
            this.top = Math.min(y, this.top);
            this.right = Math.max(x, this.right);
            this.bottom = Math.max(y, this.bottom);
            this.left = Math.min(x, this.left);
        },

        Clean: function () {
            this.top = 999;
            this.right = 0;
            this.bottom = 0;
            this.left = 999;
        }
    };

    //---------------------------------//
    //   MAIN                          //
    //---------------------------------//

    function Play() {
        var charEleArr = document.getElementsByClassName('char');
        mode = 0;

        for (var i = 0; i < charEleArr.length; i++) {
            RegisterChar(charEleArr[i], boardMap[i]);
            charEleArr[i].placeholder = "";
        }

        ToggleInputBoxes(false);

        FormatClues();
    }

    function FormatClues() {
        var cluesAcross = document.getElementById("cluesAcross"),
            cluesDown = document.getElementById("cluesDown"),
            directionAcross = document.getElementById("directionAcross"),
            directionDown = document.getElementById("directionDown");

        cluesAcross.innerHTML = "";
        cluesDown.innerHTML = "";

        cluesAcross.appendChild(directionAcross);
        cluesDown.appendChild(directionDown);

        for (i = 0; i < wordElementsAcross.length; i++) {
            var lineEle = cluesAcross.appendChild(wordElementsAcross[i].ele),
                numEle = lineEle.getElementsByClassName("lineNum")[0];
            console.log(numEle);
            numEle.innerHTML = wordElementsAcross[i].num;
            RemoveClass(numEle, 'disabled');
        }

        for (i = 0; i < wordElementsDown.length; i++) {
            var lineEle = cluesDown.appendChild(wordElementsDown[i].ele),
                numEle = lineEle.getElementsByClassName("lineNum")[0];
            numEle.innerHTML = wordElementsDown[i].num;
            RemoveClass(numEle, 'disabled');
        }
    }

    function Create() {
        wordElementsAcross = [];
        wordElementsDown = [];

        console.log();

        if (mode === 0) {
            mode = 1;
            document.getElementById("crossword").innerHTML = BoardToHtml(" ");
            ToggleInputBoxes(true);
        }
    }


    function Generate() {
        wordElementsAcross = [];
        wordElementsDown = [];

        mode = 1;
        GetWordsFromInput();

        for (var i = 0, isSuccess = false; i < 19 && !isSuccess; i++) {
            CleanVars();
            isSuccess = PopulateBoard();
        }

        document.getElementById("crossword").innerHTML =
            (isSuccess) ? BoardToHtml(" ") : "Failed to find crossword.";

        FormatClues();
        ToggleInputBoxes(true);
    }


    function ToggleInputBoxes(active) {
        var w = document.getElementsByClassName('word'),
            d = document.getElementsByClassName('clue'),
            b = document.getElementById('btnGen'),
            dir = document.getElementsByClassName('clueDirection'),
            char = document.getElementsByClassName('char');

        if (active) {
            RemoveClass(b, 'disabled');

            for (var i = 0; i < w.length; i++) {
                RemoveClass(w[i], 'hide');
                RemoveClass(d[i], 'clueReadOnly');
                d[i].disabled = '';
            }

            for (i = 0; i < dir.length; i++) {
                AddClass(dir[i], 'disabled');
            }

            for (i = 0; i < char.length; i++) {
                AddClass(char[i], 'charReadOnly');
                char[i].disabled = 'readonly';
            }
        }
        else {
            AddClass(b, 'disabled');

            for (var i = 0; i < w.length; i++) {
                AddClass(w[i], 'hide');
                AddClass(d[i], 'clueReadOnly');
                d[i].disabled = 'readonly';
            }

            for (i = 0; i < dir.length; i++) {
                RemoveClass(dir[i], 'disabled');
            }

            for (i = 0; i < char.length; i++) {
                RemoveClass(char[i], 'charReadOnly');
                char[i].disabled = '';
            }
        }
    }


    function GetWordsFromInput() {
        wordArr = [];
        for (var i = 0, val, w = document.getElementsByClassName("line"); i < w.length; i++) {
            val = w[i].getElementsByClassName("word")[0].value.toUpperCase();
            if (val !== null && val.length > 1) { wordArr.push({ ele: w[i], value: val }); }
        }
    }


    function CleanVars() {
        Bounds.Clean();
        wordBank = [];
        wordsActive = [];
        board = [];

        for (var i = 0; i < 50; i++) {
            board.push([]);
            for (var j = 0; j < 50; j++) {
                board[i].push({ value: null, char: [] });
            }
        }
    }


    function PopulateBoard() {
        PrepareBoard();
        //console.log("board: "+ board.length);
        for (var i = 0, isOk = true, len = wordBank.length; i < len && isOk; i++) {
            isOk = AddWordToBoard();
        }
        return isOk;
    }


    function PrepareBoard() {
        wordBank = [];

        for (var i = 0, len = wordArr.length; i < len; i++) {
            wordBank.push(new WordObj(wordArr[i]));
        }
        //console.log(wordBank);

        for (i = 0; i < wordBank.length; i++) {
            for (var j = 0, wA = wordBank[i]; j < wA.char.length; j++) {
                for (var k = 0, cA = wA.char[j]; k < wordBank.length; k++) {
                    for (var l = 0, wB = wordBank[k]; k !== i && l < wB.char.length; l++) {
                        wA.totalMatches += (cA === wB.char[l]) ? 1 : 0;
                    }
                }
            }
        }
    }


    // TODO: Clean this guy up
    function AddWordToBoard() {
        var i, len, curIndex, curWord, curChar, curMatch, testWord, testChar, minMatchDiff = 9999, curMatchDiff;

        if (wordsActive.length < 1) {
            curIndex = 0;
            for (i = 0, len = wordBank.length; i < len; i++) {
                if (wordBank[i].totalMatches < wordBank[curIndex].totalMatches) {
                    curIndex = i;
                }
            }
            wordBank[curIndex].successfulMatches = [{ x: 12, y: 12, dir: 0 }];
        }

        else {
            curIndex = -1;

            for (i = 0, len = wordBank.length; i < len; i++) {
                curWord = wordBank[i];
                //console.log(curWord);
                curWord.effectiveMatches = 0;
                curWord.successfulMatches = [];
                for (var j = 0, lenJ = curWord.char.length; j < lenJ; j++) {
                    curChar = curWord.char[j];
                    for (var k = 0, lenK = wordsActive.length; k < lenK; k++) {
                        testWord = wordsActive[k];
                        for (var l = 0, lenL = testWord.char.length; l < lenL; l++) {
                            testChar = testWord.char[l];
                            if (curChar === testChar) {
                                curWord.effectiveMatches++;
                                var curCross = { x: testWord.x, y: testWord.y, dir: 0 };
                                if (testWord.dir === 0) {
                                    curCross.dir = 1;
                                    curCross.x += l;
                                    curCross.y -= j;
                                }
                                else {
                                    curCross.dir = 0;
                                    curCross.y += l;
                                    curCross.x -= j;
                                }

                                var isMatch = true;

                                for (var m = -1, lenM = curWord.char.length + 1; m < lenM; m++) {
                                    var crossVal = [];
                                    if (m !== j) {
                                        if (curCross.dir === 0) {
                                            var xIndex = curCross.x + m;

                                            if (xIndex < 0 || xIndex > board.length) {
                                                isMatch = false;
                                                break;
                                            }

                                            crossVal.push(board[xIndex][curCross.y].value);
                                            crossVal.push(board[xIndex][curCross.y + 1].value);
                                            crossVal.push(board[xIndex][curCross.y - 1].value);
                                        }
                                        else {
                                            var yIndex = curCross.y + m;

                                            if (yIndex < 0 || yIndex > board[curCross.x].length) {
                                                isMatch = false;
                                                break;
                                            }

                                            crossVal.push(board[curCross.x][yIndex].value);
                                            crossVal.push(board[curCross.x + 1][yIndex].value);
                                            crossVal.push(board[curCross.x - 1][yIndex].value);
                                        }

                                        if (m > -1 && m < lenM - 1) {
                                            if (crossVal[0] !== curWord.char[m]) {
                                                if (crossVal[0] !== null) {
                                                    isMatch = false;
                                                    break;
                                                }
                                                else if (crossVal[1] !== null) {
                                                    isMatch = false;
                                                    break;
                                                }
                                                else if (crossVal[2] !== null) {
                                                    isMatch = false;
                                                    break;
                                                }
                                            }
                                        }
                                        else if (crossVal[0] !== null) {
                                            isMatch = false;
                                            break;
                                        }
                                    }
                                }

                                if (isMatch === true) {
                                    curWord.successfulMatches.push(curCross);
                                }
                            }
                        }
                    }
                }

                curMatchDiff = curWord.totalMatches - curWord.effectiveMatches;

                if (curMatchDiff < minMatchDiff && curWord.successfulMatches.length > 0) {
                    curMatchDiff = minMatchDiff;
                    curIndex = i;
                }
                else if (curMatchDiff <= 0) {
                    return false;
                }

            }
        }

        if (curIndex === -1) {
            return false;
        }

        var spliced = wordBank.splice(curIndex, 1);
        wordsActive.push(spliced[0]);

        var pushIndex = wordsActive.length - 1,
            rand = Math.random(),
            matchArr = wordsActive[pushIndex].successfulMatches,
            matchIndex = Math.floor(rand * matchArr.length),
            matchData = matchArr[matchIndex];

        wordsActive[pushIndex].x = matchData.x;
        wordsActive[pushIndex].y = matchData.y;
        wordsActive[pushIndex].dir = matchData.dir;


        var prevObj = null;

        for (i = 0, len = wordsActive[pushIndex].char.length; i < len; i++) {
            var cObj,
                cIndex,
                xInd = matchData.x,
                yInd = matchData.y;

            if (matchData.dir === 0) { xInd = matchData.x + i; }
            else { yInd = matchData.y + i; }

            cObj = {
                wordIndex: pushIndex, prev: prevObj,
                value: wordsActive[pushIndex].char[i], next: null
            };

            cIndex = board[xInd][yInd].char.length;

            board[xInd][yInd].char.push(cObj);
            board[xInd][yInd].value = wordsActive[pushIndex].char[i];

            Bounds.Update(xInd, yInd);

            if (prevObj !== null) {
                prevObj.next = board[xInd][yInd].char[cIndex];
            }

            prevObj = board[xInd][yInd].char[cIndex];
        }

        prevObj = null;
        return true;

    }


    function BoardToHtml(blank) {
        boardMap = [];

        for (var i = Bounds.top - 1, str = ""; i < Bounds.bottom + 2; i++) {
            str += "<div class='row'>";
            for (var j = Bounds.left - 1; j < Bounds.right + 2; j++) {
                str += BoardCharToElement(board[j][i]);
            }
            str += "</div>";
        }
        return str;

    }


    function BoardCharToElement(c) {
        var inner = "";
        //console.log(inner);

        if (c.value !== null) {
            var num = "";

            for (var i = 0; i < c.char.length; i++) {
                c.char[i].index = boardMap.length;
                if (c.char[i].prev === null) {
                    var matchingObj = wordsActive[c.char[i].wordIndex];

                    if (num === "") {
                        num = wordElementsDown.length + wordElementsAcross.length + 1;
                    }
                    if (matchingObj.dir === 0) {
                        wordElementsAcross.push({ num: num, ele: matchingObj.element });
                    }
                    else {
                        wordElementsDown.push({ num: num, ele: matchingObj.element });
                    }
                }
            }
            boardMap.push(c);

            inner = EleStr('input', [{ a: 'type', v: ['text'] },
            { a: 'class', v: ['char'] },
            { a: 'maxlength', v: ['1'] },
            { a: 'data-letter', v: [c.value] },
            { a: 'placeholder', v: [c.value] }],
                EleStr('span', [{ a: 'class', v: ['num'] }], num));
        }
        return EleStr('div', [{ a: 'class', v: ['square'] }], inner);
    }


    function BoardCharClick(boardChar) {
        if (mode === 1) {
            return;
        }

        if (boardChar.char.length > 1) {
            if (focusIndex >= boardChar.char.length - 1) {
                focusIndex = 0;
            }
            else {
                focusIndex++;
            }
        }
    }


    function BoardCharFocus(boardChar) {
        if (mode === 1) {
            return;
        }

        if (!(boardChar.char[focusIndex] && boardChar.char[focusIndex].prev === focusChar)) {
            focusIndex = Math.max(0, boardChar.char.indexOf(focusChar));
        }

        this.onkeydown = function (e) {
            if (mode === 1) {
                return;
            }
            var key = e.keyCode || e.which;

            if (key === 8) {
                if (boardChar.char[focusIndex].prev != null) {
                    focusChar = boardChar.char[focusIndex].prev;

                    var isEnd = (boardChar.char[focusIndex].next === null) ? true : false;

                    document.getElementsByClassName('char')
                    [boardChar.char[focusIndex].prev.index].focus();

                    if (isEnd) {
                        document.getElementsByClassName('char')
                        [boardChar.char[focusIndex].index].value = "";
                        document.getElementsByClassName('char')
                        [boardChar.char[focusIndex].next.index].value = "";
                    }
                }
            }
        }

        this.onkeypress = function () {
            if (mode === 1) {
                return;
            }
            if (boardChar.char[focusIndex].next !== null) {
                focusChar = boardChar.char[focusIndex].next;
                document.getElementsByClassName('char')
                [boardChar.char[focusIndex].next.index].focus();
            }
        }
    }


    //---------------------------------//
    //   OBJECT DEFINITIONS            //
    //---------------------------------//

    function WordObj(wordData) {
        this.element = wordData.ele;
        this.string = wordData.value;
        this.char = wordData.value.split("");
        this.totalMatches = 0;
        this.effectiveMatches = 0;
        this.successfulMatches = [];
    }


    //---------------------------------//
    //   EVENTS                        //
    //---------------------------------//

    function RegisterEvents() {
        document.getElementById("btnPlay").addEventListener(
            'click', Play, false);

        document.getElementById("btnCreate").addEventListener(
            'click', Create, false);

        document.getElementById("btnGen").addEventListener(
            'click', Generate, false);
    }
    RegisterEvents();

    function RegisterChar(ele, boardChar) {
        ele.onclick = CreateCallback("click", boardChar);
        ele.onfocus = CreateCallback("focus", boardChar);
    }

    function CreateCallback(type, boardChar) {
        switch (type) {
            case "click":
                return function () {
                    BoardCharClick(boardChar);
                };
            case "focus":
                return function () {
                    BoardCharFocus(boardChar);
                };
        }
    }


    //---------------------------------//
    //   HELPER FUNCTIONS              //
    //---------------------------------//

    function EleStr(e, c, h) {
        h = (h) ? h : "";
        for (var i = 0, s = "<" + e + " "; i < c.length; i++) {
            s += c[i].a + "='" + ArrayToString(c[i].v, " ") + "' ";
        }
        return (s + ">" + h + "</" + e + ">");
    }

    function ArrayToString(a, s) {
        if (a === null || a.length < 1) return "";
        if (s === null) s = ",";
        for (var r = a[0], i = 1; i < a.length; i++) { r += s + a[i]; }
        return r;
    }

    function AddClass(ele, classStr) {
        ele.className = ele.className.replaceAll(' ' + classStr, '') + ' ' + classStr;
    }

    function RemoveClass(ele, classStr) {
        ele.className = ele.className.replaceAll(' ' + classStr, '');
    }

    function ToggleClass(ele, classStr) {
        var str = ele.className.replaceAll(' ' + classStr, '');
        ele.className = (str.length === ele.className.length) ? str + ' ' + classStr : str;
    }

    String.prototype.replaceAll = function (replaceThis, withThis) {
        var re = new RegExp(replaceThis, "g");
        return this.replace(re, withThis);
    };


    //---------------------------------//
    //   INITIAL LOAD                  //
    //---------------------------------//

    Create();
    Generate();
    Play();


    //---------------------------------//
    // CHECK ANSWERS AND RESET LOGIC  //
    //---------------------------------//

    function checkAnswers() {
        if (!boardMap) return;
        for (let i = 0; i < boardMap.length; i++) {
            const c = boardMap[i];
            if (!c.value) continue;

            const input = document.querySelectorAll(".char")[i];
            const userVal = input.value.toUpperCase();
            const correctVal = c.value.toUpperCase();

            if (userVal === "") {
                input.style.backgroundColor = "";
            } else if (userVal === correctVal) {
                input.style.backgroundColor = "lightgreen";
            } else {
                input.style.backgroundColor = "salmon";
            }
        }
    }

    function resetBoard() {
        if (!boardMap) return;
        for (let i = 0; i < boardMap.length; i++) {
            const c = boardMap[i];
            if (!c.value) continue;

            const input = document.querySelectorAll(".char")[i];
            input.value = "";
            input.style.backgroundColor = "";
        }
    }

    function showAnswers() {
        if (!boardMap) return;
        for (let i = 0; i < boardMap.length; i++) {
            const c = boardMap[i];

            if (!c.value) continue;
            const input = document.querySelectorAll(".char")[i];
            input.value = "";
            input.style.backgroundColor = "";
            input.placeholder = c.value; // optional: show letters as placeholders
        }
    }

    // Attach to buttons
    const btnCheck = document.getElementById("btnCheck");
    const btnReset = document.getElementById("btnReset");
    const btnShow = document.getElementById("btnShow");

    btnCheck.addEventListener("click", checkAnswers);
    btnReset.addEventListener("click", resetBoard);
    btnShow.addEventListener("click", showAnswers);
</script>

</html>